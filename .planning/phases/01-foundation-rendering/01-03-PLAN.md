---
phase: 01-foundation-rendering
plan: "03"
type: execute
wave: 2
depends_on: ["01-01-PLAN.md"]
files_modified: []
autonomous: true
user_setup: []

must_haves:
  truths:
    - "When valid D2 source is provided, it renders as an SVG in the whiteboard area"
  artifacts:
    - path: "src/components/WhiteboardPanel.tsx"
      provides: "Diagram rendering display"
    - path: "src/lib/d2.ts"
      provides: "D2 rendering API client"
  key_links:
    - from: "WhiteboardPanel"
      to: "/api/render"
      via: "fetch in d2.ts"
      pattern: "POST /api/render"
---

<objective>
Build the whiteboard panel with D2 rendering pipeline. Connect frontend to the Express backend to render D2 source as SVG.
</objective>

<execution_context>
@./.opencode/get-shit-done/workflows/execute-plan.md
@./.opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01-foundation-rendering/01-CONTEXT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-rendering/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Create D2 rendering client library</name>
  <files>src/lib/d2.ts</files>
  <action>
    Create src/lib/d2.ts with:
    - renderD2(d2Source: string): Promise<{ svg: string }> - calls POST /api/render
    - Type definitions for response
    - Error handling for network errors and D2 CLI errors
    - Timeout handling (D2 can take time on complex diagrams)
  </action>
  <verify>Function can call backend and receive SVG response</verify>
  <done>D2 client library exported with renderD2 function</done>
</task>

<task type="auto">
  <name>Create WhiteboardPanel component</name>
  <files>src/components/WhiteboardPanel.tsx</files>
  <action>
    Create WhiteboardPanel.tsx with:
    - Container for SVG display
    - Renders SVG from d2 state (passed as prop or from store)
    - Empty state: "Your diagram will appear here" with placeholder
    - Loading state: subtle spinner when rendering
    - Error state: shows error message if render fails
    - White background, centered content, subtle border
  </action>
  <verify>WhiteboardPanel renders SVG when provided</verify>
  <done>WhiteboardPanel component complete with states</done>
</task>

<task type="auto">
  <name>Wire up demo D2 rendering</name>
  <files>src/App.tsx</files>
  <action>
    Update App.tsx to:
    - Pass a sample D2 source to WhiteboardPanel for demo
    - Use this simple D2 for testing: "shape: box\\nhello -> world"
    - Verify complete rendering pipeline works end-to-end
  </action>
  <verify>Sample diagram renders in whiteboard</verify>
  <done>Demo diagram visible on page load</done>
</task>

</tasks>

<verification>
- [ ] POST /api/render returns SVG
- [ ] WhiteboardPanel displays the SVG correctly
- [ ] Demo diagram renders on initial load
- [ ] Error state shows if D2 CLI unavailable
</verification>

<success_criteria>
WhiteboardPanel displays SVG diagrams rendered from D2 source. D2 rendering pipeline connected: frontend calls backend, backend runs D2 CLI, returns SVG, whiteboard displays it.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-rendering/{phase}-03-SUMMARY.md`
</output>
